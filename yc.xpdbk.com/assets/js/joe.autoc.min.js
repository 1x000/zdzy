class AutocJs{constructor(e){return this.attributes={},this.elements={article:null,wrap:null,modal:null,header:null,title:null,body:null,list:null,footer:null,switcher:null,top:null,overlay:null,anchors:[]},this.data={headings:[],chapters:[]},this.timer=null,this.initialize(e).render().addListeners(),this}initialize(e){let t,i,s=this.getElements(),l=this.getData();return this.set(AutocJs.defaults).set(e),t=document.querySelector(this.get("article")),i=this.generateHeadings(t.querySelectorAll(this.get("selector"))),s.article=t,l.headings=i,l.chapters=this.generateChapters(i),this}reload(e){return this.destroy().initialize(e).render().addListeners(),this}set(e,t){let i=AutocJs.Utils,s=this.attributes;return 2===arguments.length?s[e]=t:i.isObject(e)&&i.extend(s,e),this}get(e){return this.attributes[e]}getElements(){return this.elements}getData(){return this.data}generateHeadings(e){let t=[],i=AutocJs.Utils;return Array.prototype.forEach.call(e,e=>{t.push({id:i.guid("outline-heading"),node:e,tagName:e.tagName,level:parseInt(e.tagName.replace(/[h]/i,""),10)})}),t}generateChapters(e){let t=AutocJs.Utils,i=[],s=1,l=0;return e.forEach((e,a)=>{let r=e.level,n=-1;r>s?n=1===(l+=1)?-1:a-1:r===s||r<s&&r>l?1===r?(l=1,n=-1):n=i[a-1].pid:r<=l&&(1===r?l=1:(l-=s-r)<=1&&(l=1),n=1===l?-1:AutocJs._generatePid(i,s-r,a)),s=r,i.push({id:a,pid:n,level:l,rel:e.id,text:t.stripTags(t.trim(e.node.innerHTML))})}),this.generateChapterCode(i),i}generateChapterCode(e){let t=AutocJs.Utils.groupBy(e,"pid");return t.forEach(e=>{e.forEach((e,t)=>{e.index=t+1})}),t.forEach(t=>{t.forEach(t=>{e.forEach(e=>{-1===e.pid?e.code=String(e.index):e.pid===t.id&&(e.code=t.code+"."+e.index)})})}),this}render(){return this.renderAnchors().renderOutline(),this}renderAnchors(){let e=AutocJs.Utils.DOM,t=this.getData(),i=t.headings,s=t.chapters,l=this.getElements(),a=this.get("anchorURL");return i.forEach((t,i)=>{let r,n=t.node,o=e.createElement("i",{className:"icon icon-section outline-heading-icon"}),c=a||"#"+t.id,h="front"===this.get("anchorAt")?"outline-heading-anchor-at-front":"outline-heading-anchor-at-end",d=e.createElement("a",{"aria-hidden":!0,className:"outline-heading-anchor "+h+" outline-link outline-hidden",rel:t.id,href:c},[o]);e.addClass(n,"outline-heading"),n.id=t.id,this.get("isGenerateHeadingChapterCode")&&(r=e.createElement("span",{className:"outline-heading-code"},[s[i].code+" "]),n.insertBefore(r,n.firstChild)),this.get("isGenerateHeadingAnchor")&&(n.appendChild(d),l.anchors.push(d))}),this}renderOutline(){this.get("position").toLowerCase();return this.get("isGenerateOutline")?(this.renderOutsideOutline(),this.renderChapters(),this):this}parseDom(e){let t=document.createElement("div");return t.innerHTML=e,t.childNodes[0]}renderOutsideOutline(){let e=AutocJs.Utils.DOM,t=this.getElements(),i=this.get("title");t.title=e.createElement("span",{className:"text"},[i]);document.createElement("div");return t.header=e.createElement("div",{className:"joe_aside__item-title"},[this.parseDom('<svg t="1671352721870" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5484" xmlns:xlink="http://www.w3.org/1999/xlink" width="200" height="200"><path d="M164.601586 234.551828m-61.942554 61.942554a87.6 87.6 0 1 0 123.885108-123.885108 87.6 87.6 0 1 0-123.885108 123.885108Z" fill="#F9DB91" p-id="5485"></path><path d="M358.81 173.43m17 0l554.19 0q17 0 17 17l0 88.25q0 17-17 17l-554.19 0q-17 0-17-17l0-88.25q0-17 17-17Z" fill="#F9DB91" p-id="5486"></path><path d="M164.580021 512.008379m-85.257498 20.122598a87.6 87.6 0 1 0 170.514997-40.245196 87.6 87.6 0 1 0-170.514997 40.245196Z" fill="#AEF0FF" p-id="5487"></path><path d="M358.81 450.87m17 0l554.19 0q17 0 17 17l0 88.25q0 17-17 17l-554.19 0q-17 0-17-17l0-88.25q0-17 17-17Z" fill="#AEF0FF" p-id="5488"></path><path d="M358.81 728.32m17 0l554.19 0q17 0 17 17l0 88.25q0 17-17 17l-554.19 0q-17 0-17-17l0-88.25q0-17 17-17Z" fill="#EF6A6A" p-id="5490"></path><path d="M164.6 134a100.6 100.6 0 1 0 100.6 100.6A100.6 100.6 0 0 0 164.6 134z m0 175.2a74.6 74.6 0 1 1 74.6-74.6 74.68 74.68 0 0 1-74.6 74.55zM930 160.43H375.81a30.09 30.09 0 0 0-30 30v88.25a30.09 30.09 0 0 0 30 30H930a30.09 30.09 0 0 0 30-30v-88.25a30.09 30.09 0 0 0-30-30z m4 118.25a4.11 4.11 0 0 1-4 4H375.81a4.1 4.1 0 0 1-4-4v-88.25a4.1 4.1 0 0 1 4-4H930a4.11 4.11 0 0 1 4 4zM164.6 411.4A100.6 100.6 0 1 0 265.2 512a100.6 100.6 0 0 0-100.6-100.6z m0 175.2a74.6 74.6 0 1 1 74.6-74.6 74.68 74.68 0 0 1-74.6 74.6zM930 437.87H375.81a30.09 30.09 0 0 0-30 30v88.26a30.09 30.09 0 0 0 30 30H930a30.09 30.09 0 0 0 30-30v-88.26a30.09 30.09 0 0 0-30-30z m4 118.26a4.11 4.11 0 0 1-4 4H375.81a4.1 4.1 0 0 1-4-4v-88.26a4.1 4.1 0 0 1 4-4H930a4.11 4.11 0 0 1 4 4zM164.6 688.85a100.6 100.6 0 1 0 100.6 100.6 100.6 100.6 0 0 0-100.6-100.6z m0 175.2a74.6 74.6 0 1 1 74.6-74.6 74.69 74.69 0 0 1-74.6 74.6zM930 715.32H375.81a30.09 30.09 0 0 0-30 30v88.25a30.09 30.09 0 0 0 30 30H930a30.09 30.09 0 0 0 30-30v-88.25a30.09 30.09 0 0 0-30-30z m4 118.25a4.11 4.11 0 0 1-4 4H375.81a4.1 4.1 0 0 1-4-4v-88.25a4.1 4.1 0 0 1 4-4H930a4.11 4.11 0 0 1 4 4z" fill="#512C56" p-id="5491"></path></svg>'),t.title,e.createElement("span",{className:"line"})]),t.list=e.createElement("ul",{className:"outline-outside-list"}),t.body=e.createElement("div",{className:"joe_aside__item-contain"},[t.list]),t.switcher=e.createElement("div",{className:"outline-outside-button outline-outside-switcher"},[e.createElement("i",{className:"icon icon-menu"})]),t.top=e.createElement("div",{className:"outline-outside-button outline-outside-top"},[e.createElement("a",{href:"#top",className:"outline-outside-top"},[e.createElement("i",{className:"icon icon-arrow-up"})])]),t.wrap=e.createElement("section",{className:"joe_aside__item outline-outside"},[t.header,t.body]),document.querySelector(".joe_aside").appendChild(t.wrap),this}renderChapters(){let e=this.getData().chapters,t=AutocJs.Utils.DOM,i=this.getElements().list;return e.forEach(e=>{let s,l,a,r,n=e.pid,o=t.createElement("span",{className:"outline-chapter-text"},[e.text]),c=t.createElement("a",{className:"outline-link",href:"#"+e.rel,rel:e.rel},[o]),h=[];this.get("isGenerateOutlineChapterCode")&&(r=t.createElement("span",{className:"outline-chapter-code"},[e.code+" "]),h.push(r)),h.push(c),a=t.createElement("li",{id:"outline-chapter-"+e.id,className:"outline-chapter"},h),-1===n?i.appendChild(a):(s=document.getElementById("outline-chapter-"+n),(l=document.getElementById("outline-subject-"+n))?l.appendChild(a):(l=t.createElement("ul",{id:"outline-subject-"+n,className:"outline-subject"},[a]),s.appendChild(l)))}),this}scrollTo(e){let t=AutocJs.Utils,i=document.querySelectorAll("html,body"),s=i[0].scrollTop-i[1].scrollTop>=0?i[0]:i[1],l=s.scrollTop,a=e-s.scrollTop<0;const r=s.scrollHeight-window.innerHeight,n=e-r<=0?e:r;let o=0,c=()=>{if(this.timer&&this.stop(),o+=1,a){if(l-=t.easeInQuad(o),s.scrollTop=l,s.scrollTop<=e)return s.scrollTop=e,this.stop(),!1}else if(l+=t.easeInQuad(o),s.scrollTop=l,s.scrollTop>=n)return s.scrollTop=n,this.stop(),!1;this.timer=setTimeout(c,30)};return c(),this}stop(){return clearTimeout(this.timer),this.timer=null,this}remove(){let e=this.getElements(),t=e.wrap;return this.removeListeners(),this.get("isGenerateHeadingAnchor")&&e.anchors.forEach(e=>{e.parentNode.removeChild(e)}),t.parentNode.removeChild(t),this}destroy(){return this.remove(),this.attributes={},this.elements={article:null,wrap:null,modal:null,header:null,title:null,body:null,list:null,footer:null,switcher:null,top:null,overlay:null,anchors:[]},this.data={headings:[],chapters:[]},this.timer=null,this}removeListeners(){let e=this.getElements(),t=e.article,i=e.wrap,s=AutocJs.Utils.Events.off,l=this.get("position").toLowerCase();return s(t,"mouseenter",this._handleArticleHeadingMouseEnter),s(t,"mouseleave",this._handleArticleHeadingMouseLeave),"outside"===l&&(s(i,"click",this._handleSwitcherClick),s(i,"click",this._handleTopClick),s(i,"click",this._handleOverlayClick)),s(i,"click",this._handleChapterClick),this.get("isGenerateHeadingAnchor")&&s(t,"click",this._handleHeadingAnchorClick),this}addListeners(){let e=this.getElements(),t=e.article,i=e.wrap,s=AutocJs.Utils.Events.delegate,l=this.get("position").toLowerCase();return s(t,".outline-heading","mouseenter",this._handleArticleHeadingMouseEnter,this),s(t,".outline-heading","mouseleave",this._handleArticleHeadingMouseLeave,this),"outside"===l&&(s(i,".outline-outside-switcher","click",this._handleSwitcherClick,this),s(i,".outline-outside-top","click",this._handleTopClick,this),s(i,".outline-outside-overlay","click",this._handleOverlayClick,this)),s(i,".outline-link","click",this._handleChapterClick,this),this.get("isGenerateHeadingAnchor")&&s(t,".outline-heading-anchor","click",this._handleHeadingAnchorClick,this),this}_handleArticleHeadingMouseEnter(e){let t=e.delegateTarget.querySelector(".outline-heading-anchor");return t&&AutocJs.Utils.DOM.removeClass(t,"outline-hidden"),this}_handleArticleHeadingMouseLeave(e){let t=e.delegateTarget.querySelector(".outline-heading-anchor");return t&&AutocJs.Utils.DOM.addClass(t,"outline-hidden"),this}_handleHeadingAnchorClick(e){let t=e.delegateTarget.getAttribute("rel"),i=document.querySelector("#"+t),s=AutocJs.Utils,l=s.DOM,a=s.Events,r=l.offset(i).top;return s.isEmpty(this.get("anchorURL"))&&(this.stop().scrollTo(r),a.stop(e)),this}_handleChapterClick(e){let t=e.delegateTarget.getAttribute("rel"),i=document.querySelector("#"+t),s=AutocJs.Utils,l=s.DOM,a=s.Events,r=l.offset(i).top;return this.stop().scrollTo(r),a.stop(e),this}_handleSwitcherClick(){return this}_handleTopClick(e){let t=AutocJs.Utils.Events;return this.stop().scrollTo(0),t.stop(e),this}_handleOverlayClick(){return this}}AutocJs.defaults={article:"#article",selector:"h1,h2,h3,h4,h5,h6",title:"文章导读",position:"outside",anchorURL:"",anchorAt:"front",isGenerateOutline:!0,isGenerateOutlineChapterCode:!0,isGenerateHeadingChapterCode:!1,isGenerateHeadingAnchor:!0},AutocJs.Utils={uuid:0,isObject:e=>"[object Object]"===Object.prototype.toString.apply(e)&&null!==e,isArray:e=>Array.isArray?Array.isArray(e):"[object Array]"===Object.prototype.toString.apply(e),isElement:e=>e&&e.nodeName&&e.tagName&&1===e.nodeType,isEmpty:e=>"string"==typeof e&&""===e,guid:e=>{let t=AutocJs.Utils;return t.uuid+=1,e?e+"-"+t.uuid:"guid-"+t.uuid},trim:e=>e.replace(/^\s+/g,"").replace(/\s+$/g,""),stripTags:e=>e.replace(/<\/?[^>]+(>|$)/g,""),groupBy:(e,t)=>{const i={};return e.forEach(e=>{const s=JSON.stringify((e=>[e[t]])(e));i[s]=i[s]||[],i[s].push(e)}),Object.keys(i).map(e=>i[e])},easeInQuad:e=>e*e,extend:(e,t)=>{for(let i in t)t.hasOwnProperty(i)&&(e[i]=t[i])}},AutocJs.Utils.DOM={createElement:(e,t,i)=>{let s=AutocJs.Utils,l=s.DOM,a=document.createElement(e);for(let e in t)t.hasOwnProperty(e)&&l.setAttribute(a,e,t[e]);return s.isArray(i)&&i.forEach(e=>{let t=s.isElement(e)?e:document.createTextNode(e);a.appendChild(t)}),a},setAttribute:(e,t,i)=>{let s=e.tagName.toLowerCase();switch(t){case"style":e.style.cssText=i;break;case"value":"input"===s||"textarea"===s?e.value=i:e.setAttribute(t,i);break;case"className":e.className=i;break;default:e.setAttribute(t,i)}},hasClass(e,t){let i=e.className;return!!i&&i.match(new RegExp("(\\s|^)"+t+"(\\s|$)"))},addClass(e,t){let i=e.className;if(AutocJs.Utils.DOM.hasClass(e,t))return!1;i+=i.length>0?" "+t:t,e.className=i},removeClass(e,t){let i=AutocJs.Utils,s=e.className;if(!s||!i.DOM.hasClass(e,t))return!1;s=i.trim(s.replace(t,"")),e.className=s},offset(e){let t=AutocJs.Utils.DOM;return{left:t.offsetLeft(e),top:t.offsetTop(e)}},offsetTop(e){let t=AutocJs.Utils.DOM,i=e.offsetTop;return null!==e.offsetParent&&(i+=t.offsetTop(e.offsetParent)),i},offsetLeft(e){let t=AutocJs.Utils.DOM,i=e.offsetLeft;return null!==e.offsetParent&&(i+=t.offsetLeft(e.offsetParent)),i}},AutocJs.Utils.Events={delegate(e,t,i,s,l,a){"mouseenter"!==i&&"mouseleave"!==i||(a=!0),s._delegateWrapper=s,e.addEventListener(i,function(i){(i.delegateTarget=AutocJs.getDelegateTarget(e,i.target,t))&&s.call(l||e,i)},a||!1)},off(e,t,i,s){i._delegateWrapper&&delete(i=i._delegateWrapper)._delegateWrapper,"mouseenter"!==t&&"mouseleave"!==t||(s=!0),e.removeEventListener(t,i,s||!1)},stop(e){let t=AutocJs.Utils.Events;t.stopPropagation(e),t.preventDefault(e)},stopPropagation(e){let t=window.event;e.stopPropagation?e.stopPropagation():t.cancelBubble=!0},preventDefault(e){let t=window.event;e.preventDefault?e.preventDefault():t.returnValue=!1}},AutocJs.getDelegateTarget=((e,t,i)=>{for(;t&&t!==e;){if(AutocJs.Utils.DOM.hasClass(t,i.replace(".","")))return t;t=t.parentElement}return null}),AutocJs._generatePid=((e,t,i)=>{let s;switch(t){case 2:s=e[e[e[i-1].pid].pid].pid;break;case 3:s=e[e[e[e[i-1].pid].pid].pid].pid;break;case 4:s=e[e[e[e[e[i-1].pid].pid].pid].pid].pid;break;case 5:s=e[e[e[e[e[e[i-1].pid].pid].pid].pid].pid].pid;break;default:s=e[e[i-1].pid].pid}return s}),window.jQuery&&$.extend($.fn,{articleOutline:function(e){let t=$(this);return new AutocJs($.extend({},e,{article:t}))}});